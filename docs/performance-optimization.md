# คู่มือการปรับประสิทธิภาพ Node.js
 ## สาเหตุทั่วไปของการใช้ CPU สูง

### 1. Vite Development Server
โปรเจคของคุณใช้ Vite (จากไฟล์ `vite.config.js`) ซึ่งทำงานเป็นเซิร์ฟเวอร์สำหรับการพัฒนาพร้อมระบบ hot module replacement การทำงานนี้อาจใช้ทรัพยากร CPU มากโดยเฉพาะเมื่อ:
- มีการติดตามโครงสร้างไดเรกทอรีขนาดใหญ่
- ประมวลผลไฟล์จำนวนมากระหว่างการคอมไพล์

### 2. การคอมไพล์แบบ JIT ของ Tailwind CSS
โปรเจคใช้ Tailwind CSS ร่วมกับ PostCSS:
- ตัวคอมไพล์แบบ JIT (Just-In-Time) จะคอยติดตามการเปลี่ยนแปลงคลาสตลอดเวลา
- มันสแกนไฟล์เทมเพลททั้งหมดเพื่อสร้าง CSS
- โปรเจคขนาดใหญ่ที่มี view มากจะทำให้ใช้ CPU สูง

### 3. NPM Scripts ในโหมด Watch
การรันสคริปต์ในโหมด watch จะทำให้ Node.js ทำงานอย่างต่อเนื่อง:
- `npm run dev` หรือ `npm run watch` 
- คำสั่งเหล่านี้จะคอยติดตามการเปลี่ยนแปลงของทรัพยากรทั้งหมด

### 4. Dependencies ขนาดใหญ่
- ไฟล์ `package-lock.json` ของคุณมีขนาด 131.32 KB ซึ่งบ่งชี้ว่ามี dependencies จำนวนมาก
- แพ็คเกจ NPM บางตัวอาจมีกระบวนการที่ไม่มีประสิทธิภาพ

## วิธีแก้ไข

### วิธีแก้ไขฉับพลัน
1. **ใช้โหมด Production สำหรับการพัฒนา**
   ```bash
   npm run build
   php artisan serve
   ```
   วิธีนี้จะสร้างแอสเซ็ตเพียงครั้งเดียวโดยไม่ต้องรันตัวติดตามการเปลี่ยนแปลง

2. **จำกัดขอบเขตการสแกนของ Tailwind**
   อัปเดตไฟล์ `tailwind.config.js` เพื่อสแกนเฉพาะไฟล์ที่จำเป็น:
   ```js
   module.exports = {
     content: [
       // ระบุรูปแบบไฟล์ให้เฉพาะเจาะจงมากขึ้น
       './resources/views/**/*.blade.php',
       './resources/js/**/*.js',
       // ยกเว้นไฟล์ทดสอบหรือไดเรกทอรีที่แทบไม่มีการเปลี่ยนแปลง
     ],
     // ส่วนอื่นๆ ของการตั้งค่า...
   }
   ```

3. **ปิด HMR ชั่วคราว**
   แก้ไข `vite.config.js` เพื่อปิดการทำงานของ hot module replacement:
   ```js
   export default defineConfig({
     // ... การตั้งค่าอื่นๆ
     server: {
       hmr: false
     }
   });
   ```

4. **เพิ่มขีดจำกัดหน่วยความจำของ Node.js**
   ```bash
   export NODE_OPTIONS=--max-old-space-size=4096
   ```

### วิธีแก้ไขในระยะยาว
1. **แยกโค้ด (Code Splitting)**
   แยกไฟล์ JavaScript ขนาดใหญ่เพื่อปรับปรุงประสิทธิภาพการสร้าง

2. **ใช้การเก็บแคช**
   อัปเดตการตั้งค่าเพื่อใช้การแคชแบบถาวร

3. **เปลี่ยนไปใช้ Bun**
   สำหรับการพัฒนา พิจารณาใช้ Bun แทน Node.js:
   ```bash
   curl -fsSL https://bun.sh/install | bash
   bun install
   bun run dev
   ```
   Bun ทำงานเร็วกว่ามากสำหรับงาน JavaScript

4. **ตรวจสอบ Dependencies**
   ```bash
   npm audit
   npm prune
   ```
   ลบแพ็คเกจที่ไม่ได้ใช้เพื่อลดการใช้ทรัพยากร

5. **ใช้ส่วนขยาย VSCode ด้านประสิทธิภาพ**
   หากคุณกำลังใช้ VSCode ให้ปิดส่วนขยายที่ใช้ทรัพยากรมากเมื่อทำงานกับโปรเจคนี้

## เครื่องมือติดตามการทำงาน
- ใช้ `bun run --analyze` เพื่อแสดงขนาดบันเดิลในรูปแบบภาพ
- ติดตามเมตริกเฉพาะของ Node.js: `node --inspect` + Chrome DevTools
